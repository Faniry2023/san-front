import { Component } from '@angular/core';
import { ReactiveFormsModule, FormBuilder, Validators } from '@angular/forms';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatCardModule } from '@angular/material/card';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-user-form',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    MatFormFieldModule,
    MatInputModule,
    MatCardModule,
    MatButtonModule,
    MatIconModule
  ],
  templateUrl: './user-form.component.html',
  styleUrls: ['./user-form.component.css']
})
export class UserFormComponent {

  form = this.fb.group({
    username: ['', Validators.required],
    email: ['', [Validators.required, Validators.email]],
    mdp: ['', Validators.required],
    matricule: ['', Validators.required],
    nom: ['', Validators.required],
    prenom: ['', Validators.required],
    contact: ['', Validators.required],
    photo: [null]
  });

  preview: string | null = null;

  constructor(private fb: FormBuilder) {}

  onFileSelected(event: any) {
    const file = event.target.files[0];
    this.setImage(file);
  }

  onDrop(event: DragEvent) {
    event.preventDefault();
    const file = event.dataTransfer?.files[0];
    if (file) this.setImage(file);
  }

  onDragOver(event: DragEvent) {
    event.preventDefault();
  }

  setImage(file: File) {
    this.form.patchValue({ photo: file });

    const reader = new FileReader();
    reader.onload = () => (this.preview = reader.result as string);
    reader.readAsDataURL(file);
  }

  submit() {
    const formData = new FormData();
    Object.entries(this.form.value).forEach(([key, value]) => {
      if (value) formData.append(key, value);
    });

    console.log('FormData envoyé :', formData);
  }
}

html
<mat-card class="card">
  <h2>Créer un utilisateur</h2>

  <form [formGroup]="form" (ngSubmit)="submit()">

    <mat-form-field appearance="outline">
      <mat-label>Username</mat-label>
      <input matInput formControlName="username">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Email</mat-label>
      <input matInput formControlName="email" type="email">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Mot de passe</mat-label>
      <input matInput formControlName="mdp" type="password">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Matricule</mat-label>
      <input matInput formControlName="matricule">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Nom</mat-label>
      <input matInput formControlName="nom">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Prénom</mat-label>
      <input matInput formControlName="prenom">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Contact</mat-label>
      <input matInput formControlName="contact">
    </mat-form-field>

    <!-- DRAG & DROP UPLOAD -->
    <div class="upload-zone"
         (drop)="onDrop($event)"
         (dragover)="onDragOver($event)"
         (click)="fileInput.click()">

      <mat-icon>cloud_upload</mat-icon>
      <p>Glissez une image ici ou cliquez pour choisir</p>

      <input type="file"
             #fileInput
             hidden
             accept="image/*"
             (change)="onFileSelected($event)">
    </div>

    <!-- IMAGE PREVIEW -->
    <img *ngIf="preview" [src]="preview" class="preview-img">

    <button mat-raised-button color="primary" type="submit">
      Enregistrer
    </button>

  </form>
</mat-card>


css:

.card {
  max-width: 600px;
  margin: 20px auto;
  padding: 20px;
}

mat-form-field {
  width: 100%;
  margin-bottom: 12px;
}

.upload-zone {
  border: 2px dashed #3f51b5;
  border-radius: 8px;
  text-align: center;
  padding: 20px;
  cursor: pointer;
  color: #3f51b5;
  margin-bottom: 20px;
  transition: 0.2s;
}

.upload-zone:hover {
  background: rgba(63, 81, 181, 0.08);
}

.upload-zone mat-icon {
  font-size: 40px;
  margin-bottom: 10px;
}

.preview-img {
  width: 150px;
  height: 150px;
  object-fit: cover;
  margin: 10px auto;
  display: block;
  border-radius: 8px;
  border: 1px solid #ccc;
}









export interface User {
  username: string;
  email: string;
  mdp: string;
  matricule: string;
  nom: string;
  prenom: string;
  contact: string;
  photo: File | null;
}
